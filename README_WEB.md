# 在留資格管理システム - Web版

HTMLベースのGUIで、セル単位での背景色設定が可能な在留資格管理システムです。

## 特徴

### ✨ 主な機能

- **セル単位の背景色設定**: 期限日が超過しているセルのみに赤色の背景を適用
- **行全体の色分け**: 満了日数に基づいて行全体を色分け表示
- **リアルタイム検索**: 氏名、担当者コード、在留資格などで即座に検索
- **柔軟なフィルタリング**: 期限日超過、期限切れ、日数別など多様なフィルター
- **データエクスポート**: アラートリストや処理済みデータの出力
- **レスポンシブデザイン**: PC、タブレット、スマートフォンに対応

### 🎨 色分けルール

#### 行の背景色（満了日数に基づく）
- **赤色** (#FFC7CE): 満了期限切れ（満了日数 < 0）
- **オレンジ色** (#FFE699): 緊急（7日以内）
- **黄色** (#FFEB9C): 警告（30日以内）
- **緑色** (#C6EFCE): 注意（60日以内）
- **白色**: 安全（61日以上）

#### セルの背景色（期限日に基づく）
- **濃い赤色** (#FF6B6B): 期限日1、期限日2、期限日3のいずれかが超過している場合、そのセルのみ

## インストール

### 1. 必要なパッケージをインストール

```bash
pip install -r requirements.txt
```

### 2. フォルダ構成の確認

以下のフォルダ構成になっていることを確認してください：

```
在留資格管理/
├── app.py                      # Flaskアプリケーション
├── residence_manager.py        # データ処理クラス
├── requirements.txt            # 必要なパッケージ
├── 在留資格管理.xlsx           # データファイル（オプション）
├── templates/
│   └── index.html             # HTMLテンプレート
├── static/
│   ├── css/
│   │   └── style.css          # スタイルシート
│   └── js/
│       └── app.js             # JavaScript
└── uploads/                    # アップロードファイル用（自動作成）
```

## 使い方

### 1. アプリケーションの起動

```bash
python app.py
```

起動すると以下のメッセージが表示されます：

```
================================================================================
在留資格管理システム - Web版
================================================================================

ブラウザで以下のURLにアクセスしてください:
http://localhost:5000

終了するには Ctrl+C を押してください
================================================================================
```

### 2. ブラウザでアクセス

ブラウザで以下のURLを開きます：

```
http://localhost:5000
```

### 3. データの読み込み

- **デフォルトファイル**: `在留資格管理.xlsx` が同じフォルダにある場合、自動的に読み込まれます
- **手動アップロード**: 「📂 ファイルを開く」ボタンをクリックして、Excelファイルを選択

### 4. データの操作

#### フィルタリング
- **すべて**: 全データを表示
- **期限日超過**: 期限日1、2、3のいずれかが超過しているデータのみ
- **期限切れ**: 満了年月日が過ぎているデータのみ
- **30日以内**: 満了まで30日以内のデータのみ
- **60日以内**: 満了まで60日以内のデータのみ
- **90日以内**: 満了まで90日以内のデータのみ

#### 検索
検索ボックスに入力すると、以下の項目で検索されます：
- 担当者コード
- 氏名１
- 氏名２
- 在留資格
- 国籍

#### ソート
テーブルのヘッダーをクリックすると、その列でソートされます。
もう一度クリックすると、昇順/降順が切り替わります。

### 5. データのエクスポート

- **📊 アラートリスト出力**: 30日以内に期限を迎えるデータをExcelファイルとして出力
- **💾 処理済みデータ保存**: 計算フィールド（満了日数、期限日など）を含む全データを出力

## 表示例

### 期限日超過の表示

期限日が超過している場合、そのセルのみが濃い赤色の背景になり、以下のように表示されます：

```
🔴⚠️ 2024/10/15 (超過5日)
```

### 行の色分け

満了日数に応じて、行全体の背景色が変わります：
- 期限切れの行: 赤色の背景
- 緊急の行: オレンジ色の背景
- 警告の行: 黄色の背景
- 注意の行: 緑色の背景
- 安全な行: 白色の背景

## トラブルシューティング

### ポート5000が既に使用されている場合

`app.py` の最後の行を以下のように変更してください：

```python
app.run(debug=True, host='0.0.0.0', port=5001)  # ポート番号を変更
```

### データが表示されない場合

1. ブラウザのコンソール（F12キー）でエラーを確認
2. Excelファイルに「満了年月日」列があることを確認
3. サーバーのターミナルでエラーメッセージを確認

### スタイルが適用されない場合

ブラウザのキャッシュをクリアするか、スーパーリロード（Ctrl+Shift+R）を実行してください。

## 従来版との比較

| 機能 | tkinter版 | Web版 |
|------|-----------|-------|
| セル単位の背景色 | ❌ 不可 | ✅ 可能 |
| 行全体の背景色 | ✅ 可能 | ✅ 可能 |
| リモートアクセス | ❌ 不可 | ✅ 可能 |
| マルチプラットフォーム | △ 制限あり | ✅ 完全対応 |
| モダンなUI | △ 基本的 | ✅ モダン |

## 技術スタック

- **バックエンド**: Flask 2.3+
- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla)
- **データ処理**: pandas, openpyxl
- **スタイリング**: カスタムCSS（グラデーション、レスポンシブデザイン）

## ライセンス

このプロジェクトは内部使用を目的としています。

## 更新履歴

### v3.0 (2024/10/20)
- HTMLベースのGUIに変更
- セル単位での背景色設定を実装
- レスポンシブデザインに対応
- モダンなUIデザインを採用
